<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>SVG文本字体加载与图片导出 - 功能测试</h1>
    
    <div class="test-section">
        <h2>1. 字体加载测试</h2>
        <p>测试FontFace API是否可用</p>
        <button class="test-button" onclick="testFontLoading()">测试字体加载</button>
        <div id="fontTestResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. SVG创建测试</h2>
        <p>测试SVG元素创建和文本渲染</p>
        <button class="test-button" onclick="testSVGCreation()">测试SVG创建</button>
        <div id="svgTestResult" class="result"></div>
        <div id="svgPreview"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Canvas导出测试</h2>
        <p>测试Canvas API和图片导出功能</p>
        <button class="test-button" onclick="testCanvasExport()">测试Canvas导出</button>
        <div id="canvasTestResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. 文件下载测试</h2>
        <p>测试Blob URL和文件下载功能</p>
        <button class="test-button" onclick="testFileDownload()">测试文件下载</button>
        <div id="downloadTestResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>5. 页面跳转测试</h2>
        <p>测试各个功能页面是否正常</p>
        <button class="test-button" onclick="window.open('demo.html', '_blank')">打开演示页面</button>
        <button class="test-button" onclick="window.open('svg-text-exporter.html', '_blank')">打开SVG导出器</button>
        <button class="test-button" onclick="window.open('index.html', '_blank')">打开刺绣效果</button>
    </div>

    <script>
        function testFontLoading() {
            const result = document.getElementById('fontTestResult');
            try {
                if (typeof FontFace !== 'undefined') {
                    result.innerHTML = '✅ FontFace API 可用';
                    result.style.background = '#d4edda';
                    result.style.color = '#155724';
                } else {
                    result.innerHTML = '❌ FontFace API 不可用';
                    result.style.background = '#f8d7da';
                    result.style.color = '#721c24';
                }
            } catch (error) {
                result.innerHTML = '❌ 字体加载测试失败: ' + error.message;
                result.style.background = '#f8d7da';
                result.style.color = '#721c24';
            }
        }
        
        function testSVGCreation() {
            const result = document.getElementById('svgTestResult');
            const preview = document.getElementById('svgPreview');
            try {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '200');
                svg.setAttribute('height', '100');
                svg.setAttribute('viewBox', '0 0 200 100');
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', '100');
                text.setAttribute('y', '50');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('font-size', '20');
                text.setAttribute('fill', '#333');
                text.textContent = 'SVG测试';
                
                svg.appendChild(text);
                preview.innerHTML = '';
                preview.appendChild(svg);
                
                result.innerHTML = '✅ SVG创建成功';
                result.style.background = '#d4edda';
                result.style.color = '#155724';
            } catch (error) {
                result.innerHTML = '❌ SVG创建失败: ' + error.message;
                result.style.background = '#f8d7da';
                result.style.color = '#721c24';
            }
        }
        
        function testCanvasExport() {
            const result = document.getElementById('canvasTestResult');
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                if (!ctx) {
                    throw new Error('Canvas 2D context 不可用');
                }
                
                canvas.width = 200;
                canvas.height = 100;
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 200, 100);
                
                ctx.fillStyle = '#333333';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Canvas测试', 100, 50);
                
                canvas.toBlob((blob) => {
                    if (blob) {
                        result.innerHTML = '✅ Canvas导出成功，Blob大小: ' + blob.size + ' bytes';
                        result.style.background = '#d4edda';
                        result.style.color = '#155724';
                    } else {
                        throw new Error('Canvas toBlob 失败');
                    }
                }, 'image/png');
                
            } catch (error) {
                result.innerHTML = '❌ Canvas导出失败: ' + error.message;
                result.style.background = '#f8d7da';
                result.style.color = '#721c24';
            }
        }
        
        function testFileDownload() {
            const result = document.getElementById('downloadTestResult');
            try {
                const text = '测试文件内容';
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                if (url) {
                    result.innerHTML = '✅ Blob URL创建成功: ' + url.substring(0, 50) + '...';
                    result.style.background = '#d4edda';
                    result.style.color = '#155724';
                    
                    // 清理URL
                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                    }, 1000);
                } else {
                    throw new Error('Blob URL创建失败');
                }
            } catch (error) {
                result.innerHTML = '❌ 文件下载测试失败: ' + error.message;
                result.style.background = '#f8d7da';
                result.style.color = '#721c24';
            }
        }
        
        // 页面加载完成后自动运行测试
        document.addEventListener('DOMContentLoaded', function() {
            console.log('功能测试页面加载完成');
            console.log('浏览器信息:', navigator.userAgent);
            console.log('当前URL:', window.location.href);
        });
    </script>
</body>
</html>